<!doctype html>
<html lang="id" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kalkulator Jualan</title>
   <title>Sayangku SARAH</title>
    
    <script src="https://cdn.tailwindcss.com/3.4.17"></script>
    <script src="/_sdk/element_sdk.js"></script>
    <script src="/_sdk/data_sdk.js" type="text/javascript"></script>

    <link
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <style>
      :root{
        --bg: #ecfdf5;
        --primary: #10b981;
        --text: #1f2937;
        --card: #ffffff;
        --accent: #059669;
        --font: "Plus Jakarta Sans", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        --font-size: 16px;
      }

      html, body { height: 100%; }
      body {
        box-sizing: border-box;
        font-family: var(--font);
        font-size: var(--font-size);
        background: var(--bg);
        color: var(--text);
      }

      .input-field:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2);
      }
      .result-card { transition: all 0.3s ease; }
      .result-card:hover { transform: translateY(-2px); }

      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .animate-fade { animation: fadeIn 0.4s ease-out forwards; }

      .profit-positive { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
      .profit-negative { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
      .requirement-pass { background: #dcfce7; border-left: 4px solid #10b981; }
      .requirement-fail { background: #fee2e2; border-left: 4px solid #ef4444; }
    </style>
  </head>

  <body class="h-full">
    <div id="app" class="h-full w-full overflow-auto">
      <div class="min-h-full w-full px-4 py-8 md:px-8">
        <div class="max-w-lg mx-auto">
          <!-- Header -->
          <div class="text-center mb-8 animate-fade">
            <div
              class="inline-flex items-center justify-center w-16 h-16 rounded-2xl mb-4 shadow-lg"
              style="background: var(--primary)"
              aria-hidden="true"
            >
              <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z">
                </path>
              </svg>
            </div>
            <h1 id="app-title" class="text-2xl md:text-3xl font-bold text-gray-800">Kalkulator Jualan</h1>
            <p class="text-gray-500 mt-2">Hitung keuntungan jualan Anda dengan mudah</p>
          </div>

          <!-- Info Tetap -->
          <div class="bg-blue-50 rounded-2xl p-5 mb-6 border-2 border-blue-200 animate-fade" style="animation-delay: 0.05s;">
            <div class="flex items-center gap-2 mb-3">
              <span class="text-2xl" aria-hidden="true">ğŸ“Œ</span>
              <span class="font-bold text-gray-800">Info Tetap (Tidak Berubah)</span>
            </div>
            <div class="grid grid-cols-2 gap-3 text-sm">
              <div class="bg-white rounded-lg p-3">
                <p class="text-gray-600 mb-1">ğŸ‘¤ Pribadi</p>
                <p class="font-bold text-gray-800">3 pcs @ Rp 5.000</p>
              </div>
              <div class="bg-white rounded-lg p-3">
                <p class="text-gray-600 mb-1">ğŸ“¦ Titipan</p>
                <p class="font-bold text-gray-800">3 pcs @ Rp 4.000</p>
              </div>
            </div>
          </div>

          <!-- Form -->
          <div class="bg-white rounded-3xl shadow-xl p-6 md:p-8 mb-6 animate-fade" style="animation-delay: 0.1s;">
            <div class="mb-5">
              <label for="modal" class="block text-sm font-semibold text-gray-700 mb-2">ğŸ’° Modal Total</label>
              <div class="relative">
                <span id="currency-1" class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium">Rp</span>
                <input
                  type="number"
                  id="modal"
                  class="input-field w-full pl-12 pr-4 py-4 bg-gray-50 border-2 border-gray-200 rounded-xl text-lg font-medium text-gray-800 transition-all"
                  placeholder="0"
                  min="0"
                  inputmode="numeric"
                />
              </div>
              <p id="modal-help" class="mt-2 text-xs text-gray-500">Isi angka total modal (contoh: 150000).</p>
            </div>

            <div class="mb-5">
              <label for="pemasukan" class="block text-sm font-semibold text-gray-700 mb-2">ğŸ’µ Pemasukan Total</label>
              <div class="relative">
                <span id="currency-2" class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium">Rp</span>
                <input
                  type="number"
                  id="pemasukan"
                  class="input-field w-full pl-12 pr-4 py-4 bg-gray-50 border-2 border-gray-200 rounded-xl text-lg font-medium text-gray-800 transition-all"
                  placeholder="0"
                  min="0"
                  inputmode="numeric"
                />
              </div>
            </div>

            <div class="mb-5">
              <label for="terjual" class="block text-sm font-semibold text-gray-700 mb-2">âœ… Jumlah pcs Terjual</label>
              <input
                type="number"
                id="terjual"
                class="input-field w-full px-4 py-4 bg-gray-50 border-2 border-gray-200 rounded-xl text-lg font-medium text-gray-800 transition-all"
                placeholder="0"
                min="0"
                value="0"
                inputmode="numeric"
              />
            </div>

            <div class="mb-6">
              <label for="tidakterjual" class="block text-sm font-semibold text-gray-700 mb-2">âŒ Jumlah pcs Tidak Terjual</label>
              <input
                type="number"
                id="tidakterjual"
                class="input-field w-full px-4 py-4 bg-gray-50 border-2 border-gray-200 rounded-xl text-lg font-medium text-gray-800 transition-all"
                placeholder="0"
                min="0"
                value="0"
                inputmode="numeric"
              />
            </div>

            <button
              id="calculate-btn"
              type="button"
              class="w-full py-4 text-white font-bold text-lg rounded-xl transition-all transform hover:scale-[1.02] active:scale-[0.98] shadow-lg"
              style="background: var(--primary); box-shadow: 0 10px 25px rgba(16,185,129,0.25)"
            >
              Hitung Keuntungan ğŸš€
            </button>

            <p id="form-error" class="hidden mt-4 text-sm text-red-600 font-semibold" role="alert"></p>
          </div>

          <!-- Results -->
          <div id="results" class="hidden animate-fade" style="animation-delay: 0.2s;" aria-live="polite">
            <div class="grid grid-cols-2 gap-4 mb-4">
              <div class="result-card bg-white rounded-2xl p-5 shadow-lg">
                <div class="flex items-center gap-2 mb-2">
                  <span class="text-2xl" aria-hidden="true">ğŸ’µ</span>
                  <span class="text-sm font-medium text-gray-500">Total Modal</span>
                </div>
                <p id="total-modal" class="text-xl font-bold text-gray-800">Rp 0</p>
              </div>

              <div class="result-card bg-white rounded-2xl p-5 shadow-lg">
                <div class="flex items-center gap-2 mb-2">
                  <span class="text-2xl" aria-hidden="true">ğŸ“Š</span>
                  <span class="text-sm font-medium text-gray-500">Total pcs</span>
                </div>
                <p id="total-pcs" class="text-xl font-bold text-gray-800">0 pcs</p>
              </div>
            </div>

            <div class="result-card bg-white rounded-2xl p-5 shadow-lg mb-4">
              <div class="flex items-center gap-2 mb-3">
                <span class="text-2xl" aria-hidden="true">ğŸ“¦</span>
                <span class="font-semibold text-gray-700">Breakdown Stok</span>
              </div>
              <div class="space-y-2 text-sm">
                <div class="flex justify-between">
                  <span class="text-gray-500">âœ… Terjual:</span>
                  <span id="breakdown-terjual" class="font-semibold text-emerald-600">0 pcs</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-500">âŒ Tidak Terjual:</span>
                  <span id="breakdown-tidakterjual" class="font-semibold text-orange-600">0 pcs</span>
                </div>
              </div>
            </div>

            <div id="profit-card" class="result-card profit-positive rounded-2xl p-6 shadow-xl text-white mb-4">
              <div class="flex items-center justify-between mb-3">
                <div class="flex items-center gap-2">
                  <span class="text-3xl" id="profit-icon" aria-hidden="true">ğŸ“ˆ</span>
                  <span class="text-lg font-medium opacity-90" id="profit-label">Keuntungan</span>
                </div>
                <span id="profit-percentage" class="px-3 py-1 bg-white/20 rounded-full text-sm font-bold">+0%</span>
              </div>
              <p id="profit-amount" class="text-3xl md:text-4xl font-bold">Rp 0</p>
            </div>

            <div class="result-card bg-white rounded-2xl p-5 shadow-lg mb-4">
              <div class="flex items-center gap-2 mb-4">
                <span class="text-2xl" aria-hidden="true">âœ…</span>
                <span class="font-bold text-gray-800">Checklist Requirement</span>
              </div>
              <div id="requirements" class="space-y-2"></div>
            </div>

            <div id="recommendation" class="result-card bg-gradient-to-r from-purple-50 to-blue-50 rounded-2xl p-5 shadow-lg mb-4 border-2 border-purple-200">
              <div class="flex items-center gap-2 mb-3">
                <span class="text-2xl" aria-hidden="true">ğŸ’¡</span>
                <span class="font-bold text-gray-800">AI Smart Recommendation</span>
              </div>
              <p id="recommendation-text" class="text-sm text-gray-700 leading-relaxed"></p>
              <div class="mt-3 flex items-center gap-2">
                <span id="recommendation-status" class="text-3xl" aria-hidden="true">ğŸš€</span>
                <span id="recommendation-level" class="font-bold text-gray-800"></span>
              </div>
            </div>
          </div>

          <button
            id="reset-btn"
            type="button"
            class="hidden w-full mt-4 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold rounded-xl transition-all"
          >
            ğŸ”„ Hitung Ulang
          </button>
        </div>
      </div>
    </div>

    <script>
      "use strict";

      // ========= Config =========
      const defaultConfig = {
        app_title: "Kalkulator Jualan",
        currency_symbol: "Rp",
        background_color: "#ecfdf5",
        primary_color: "#10b981",
        text_color: "#1f2937",
        card_color: "#ffffff",
        accent_color: "#059669",
        font_family: "Plus Jakarta Sans",
        font_size: 16,
      };

      // Data tetap (kalau nanti mau dipakai untuk perhitungan, sudah siap strukturnya)
      const datatetap = Object.freeze({
        pribadi: { pcs: 3, harga: 5000 },
        titipan: { pcs: 3, harga: 4000 },
      });

      // ========= DOM helpers =========
      const $ = (id) => document.getElementById(id);

      const ui = {
        title: $("app-title"),
        currency1: $("currency-1"),
        currency2: $("currency-2"),
        modal: $("modal"),
        pemasukan: $("pemasukan"),
        terjual: $("terjual"),
        tidakterjual: $("tidakterjual"),
        btnCalc: $("calculate-btn"),
        btnReset: $("reset-btn"),
        results: $("results"),
        error: $("form-error"),

        totalModal: $("total-modal"),
        totalPcs: $("total-pcs"),
        breakdownTerjual: $("breakdown-terjual"),
        breakdownTidakTerjual: $("breakdown-tidakterjual"),

        profitCard: $("profit-card"),
        profitIcon: $("profit-icon"),
        profitLabel: $("profit-label"),
        profitPercentage: $("profit-percentage"),
        profitAmount: $("profit-amount"),

        reqContainer: $("requirements"),
        recStatus: $("recommendation-status"),
        recLevel: $("recommendation-level"),
        recText: $("recommendation-text"),
      };

      function applyTheme(config) {
        const cfg = { ...defaultConfig, ...(config || {}) };
        document.documentElement.style.setProperty("--bg", cfg.background_color);
        document.documentElement.style.setProperty("--primary", cfg.primary_color);
        document.documentElement.style.setProperty("--text", cfg.text_color);
        document.documentElement.style.setProperty("--card", cfg.card_color);
        document.documentElement.style.setProperty("--accent", cfg.accent_color);
        document.documentElement.style.setProperty("--font", cfg.font_family);
        document.documentElement.style.setProperty("--font-size", `${Number(cfg.font_size) || defaultConfig.font_size}px`);

        ui.title.textContent = cfg.app_title;
        ui.currency1.textContent = cfg.currency_symbol;
        ui.currency2.textContent = cfg.currency_symbol;
      }

      // ========= Formatters =========
      function formatCurrency(amount, symbolOverride) {
        const cfg = window.elementSdk?.config || defaultConfig;
        const symbol = symbolOverride || cfg.currency_symbol || defaultConfig.currency_symbol;
        const safe = Number.isFinite(amount) ? amount : 0;
        return `${symbol} ${safe.toLocaleString("id-ID")}`;
      }

      // ========= Business logic =========
      function clampNonNegativeInt(n) {
        const x = Number.parseInt(n, 10);
        return Number.isFinite(x) && x > 0 ? x : 0;
      }

      function parseMoney(n) {
        const x = Number.parseFloat(n);
        return Number.isFinite(x) && x >= 0 ? x : 0;
      }

      function compute(modal, pemasukan, terjual, tidakterjual) {
        const totalPcs = terjual + tidakterjual;
        const keuntungan = pemasukan - modal;
        const roiPct = modal > 0 ? (keuntungan / modal) * 100 : 0;

        const modalPerPcs = totalPcs > 0 ? modal / totalPcs : 0;
        const jualPerPcs = totalPcs > 0 ? pemasukan / totalPcs : 0;

        // Margin sederhana: (jual - modal) / jual * 100 (lebih umum di bisnis)
        const marginPct = pemasukan > 0 ? (keuntungan / pemasukan) * 100 : 0;

        return {
          modal,
          pemasukan,
          terjual,
          tidakterjual,
          totalPcs,
          keuntungan,
          roiPct,
          marginPct,
          modalPerPcs,
          jualPerPcs,
        };
      }

      function generateRequirements(m) {
        return [
          {
            text: "ğŸ’° Status Keuangan",
            pass: m.keuntungan >= 0,
            detail: m.keuntungan >= 0
              ? `Untung: ${formatCurrency(m.keuntungan)}`
              : `Rugi: ${formatCurrency(Math.abs(m.keuntungan))}`,
          },
          {
            text: "ğŸ“Š Margin â‰¥ 20%",
            pass: m.marginPct >= 20,
            detail: `Margin: ${m.marginPct.toFixed(1)}%`,
          },
          {
            text: "ğŸ“ˆ ROI â‰¥ 30%",
            pass: m.roiPct >= 30,
            detail: `ROI: ${m.roiPct.toFixed(1)}%`,
          },
          {
            text: "ğŸ·ï¸ Harga Jual â‰¥ 1.5x Modal per pcs",
            pass: m.jualPerPcs >= m.modalPerPcs * 1.5,
            detail: `${formatCurrency(m.jualPerPcs)} vs ${formatCurrency(m.modalPerPcs * 1.5)}`,
          },
          {
            text: "ğŸ“¦ Volume â‰¥ 5 pcs Terjual",
            pass: m.terjual >= 5,
            detail: `Terjual: ${m.terjual} pcs`,
          },
        ];
      }

      function generateRecommendation(requirements) {
        const passCount = requirements.filter((r) => r.pass).length;
        const totalCount = requirements.length;
        const percentage = (passCount / totalCount) * 100;

        if (percentage === 100) {
          return {
            status: "ğŸš€",
            level: "Sempurna (100%)",
            text: "Luar biasa! Semua metrik terpenuhi. Pertahankan ritme ini, dan pertimbangkan scale up (stok, channel, atau variasi produk).",
            percentage,
          };
        }
        if (percentage >= 80) {
          return {
            status: "ğŸ˜Š",
            level: "Sangat Bagus (80%+)",
            text: "Kinerja sudah sangat baik. Tinggal rapikan satu-dua titik lemah (biasanya margin, ROI, atau volume) untuk hasil makin stabil.",
            percentage,
          };
        }
        if (percentage >= 60) {
          return {
            status: "ğŸ“ˆ",
            level: "Ada Potensi (60%+)",
            text: "Potensinya jelas ada. Fokuskan perbaikan pada requirement yang belum lolos: pricing, efisiensi modal, atau dorong volume penjualan.",
            percentage,
          };
        }
        if (percentage >= 40) {
          return {
            status: "âš ï¸",
            level: "Perlu Perhatian (40%+)",
            text: "Banyak metrik belum terpenuhi. Cek ulang strategi harga, kontrol biaya, dan target volume. Naikkan margin dulu, baru gas volume.",
            percentage,
          };
        }
        return {
          status: "ğŸš¨",
          level: "Tindakan Segera (<40%)",
          text: "Kondisi sedang berat. Pertimbangkan evaluasi total: struktur biaya, harga jual, produk yang paling laku, dan channel pemasaran.",
          percentage,
        };
      }

      // ========= Rendering =========
      function setError(message) {
        if (!message) {
          ui.error.classList.add("hidden");
          ui.error.textContent = "";
          return;
        }
        ui.error.textContent = message;
        ui.error.classList.remove("hidden");
      }

      function render(m) {
        ui.totalModal.textContent = formatCurrency(m.modal);
        ui.totalPcs.textContent = `${m.totalPcs} pcs`;
        ui.breakdownTerjual.textContent = `${m.terjual} pcs`;
        ui.breakdownTidakTerjual.textContent = `${m.tidakterjual} pcs`;
        ui.profitAmount.textContent = formatCurrency(Math.abs(m.keuntungan));

        if (m.keuntungan >= 0) {
          ui.profitCard.className = "result-card profit-positive rounded-2xl p-6 shadow-xl text-white mb-4";
          ui.profitIcon.textContent = "ğŸ“ˆ";
          ui.profitLabel.textContent = "Keuntungan";
          ui.profitPercentage.textContent = `+${m.roiPct.toFixed(1)}%`;
        } else {
          ui.profitCard.className = "result-card profit-negative rounded-2xl p-6 shadow-xl text-white mb-4";
          ui.profitIcon.textContent = "ğŸ“‰";
          ui.profitLabel.textContent = "Kerugian";
          ui.profitPercentage.textContent = `${m.roiPct.toFixed(1)}%`;
        }

        const requirements = generateRequirements(m);
        ui.reqContainer.innerHTML = requirements
          .map(
            (req) => `
          <div class="${req.pass ? "requirement-pass" : "requirement-fail"} rounded-lg p-3">
            <div class="flex items-center justify-between">
              <span class="font-semibold text-gray-800">${req.text}</span>
              <span aria-hidden="true">${req.pass ? "âœ…" : "âŒ"}</span>
            </div>
            <p class="text-xs text-gray-600 mt-1">${req.detail}</p>
          </div>
        `
          )
          .join("");

        const rec = generateRecommendation(requirements);
        ui.recStatus.textContent = rec.status;
        ui.recLevel.textContent = rec.level;
        ui.recText.textContent = rec.text;

        ui.results.classList.remove("hidden");
        ui.btnReset.classList.remove("hidden");
      }

      // ========= Actions =========
      function calculate() {
        setError("");

        const modal = parseMoney(ui.modal.value);
        const pemasukan = parseMoney(ui.pemasukan.value);
        const terjual = clampNonNegativeInt(ui.terjual.value);
        const tidakterjual = clampNonNegativeInt(ui.tidakterjual.value);

        // Validasi profesional: jelas, tidak pakai alert yang â€œmengagetkanâ€
        if (modal <= 0 || pemasukan <= 0) {
          setError("Mohon isi Modal Total dan Pemasukan Total (harus lebih dari 0).");
          return;
        }

        const m = compute(modal, pemasukan, terjual, tidakterjual);
        render(m);
      }

      function resetCalculator() {
        setError("");
        ui.modal.value = "";
        ui.pemasukan.value = "";
        ui.terjual.value = "0";
        ui.tidakterjual.value = "0";
        ui.results.classList.add("hidden");
        ui.btnReset.classList.add("hidden");
      }

      // ========= SDK integration =========
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange: async (config) => {
            applyTheme(config);
            // Recalculate if inputs already filled
            if (ui.modal.value && ui.pemasukan.value) calculate();
          },
          mapToCapabilities: (config) => ({
            recolorables: [
              {
                get: () => config.background_color || defaultConfig.background_color,
                set: (value) => window.elementSdk.setConfig({ background_color: value }),
              },
              {
                get: () => config.primary_color || defaultConfig.primary_color,
                set: (value) => window.elementSdk.setConfig({ primary_color: value }),
              },
              {
                get: () => config.text_color || defaultConfig.text_color,
                set: (value) => window.elementSdk.setConfig({ text_color: value }),
              },
            ],
            borderables: [],
            fontEditable: {
              get: () => config.font_family || defaultConfig.font_family,
              set: (value) => window.elementSdk.setConfig({ font_family: value }),
            },
            fontSizeable: {
              get: () => config.font_size || defaultConfig.font_size,
              set: (value) => window.elementSdk.setConfig({ font_size: value }),
            },
          }),
          mapToEditPanelValues: (config) =>
            new Map([
              ["app_title", config.app_title || defaultConfig.app_title],
              ["currency_symbol", config.currency_symbol || defaultConfig.currency_symbol],
            ]),
        });
      } else {
        // fallback if SDK not present
        applyTheme(defaultConfig);
      }

      // ========= Events =========
      ui.btnCalc.addEventListener("click", calculate);
      ui.btnReset.addEventListener("click", resetCalculator);

      // Enter key support (better: keydown, not keypress)
      ["modal", "pemasukan", "terjual", "tidakterjual"].forEach((id) => {
        $(id).addEventListener("keydown", (e) => {
          if (e.key === "Enter") calculate();
        });
      });

      // Initial theme
      applyTheme(window.elementSdk?.config || defaultConfig);
    </script>
  </body>

</html>
